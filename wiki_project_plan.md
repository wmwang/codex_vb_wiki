# VB 系統 Code Wiki / Deep Wiki 專案規劃

## 目標與成功指標
- **生產級 Wiki 平台**：可擴展、可備援、可觀測、具備存取控制與稽核能力。
- **內容豐富與可維護**：以標準化模板與內容治理流程確保一致性。
- **LLM 輔助知識化**：自動萃取、摘要與跨文件關聯，並提供問答與內容建議。
- **可遷移**：以「Speaker 規格」輸出結構化文件，支援未來大型語言模型遷移與新語言架構重構。

**衡量指標（建議）**
- 內容涵蓋率：核心模組/子系統頁面覆蓋率 ≥ 90%
- 搜尋/問答命中率：Top-3 命中 ≥ 80%
- 文檔更新時效：變更後 48 小時內完成更新
- 服務可用性：99.9%

## 需求分層
### 功能需求
1. **文件管理**：版本控制、審核、變更記錄、權限管理。
2. **搜尋與問答**：全域搜尋、向量檢索、RAG 問答。
3. **語義關聯**：模組/函式/資料表/批次作業互相關聯。
4. **內容模板**：統一格式（用途、依賴、流程、範例、注意事項）。
5. **Speaker 規格輸出**：以結構化欄位輸出（JSON/YAML）供後續遷移使用。

### 非功能需求
- **高可用**：多節點、備援、災難復原（RTO/RPO 目標）。
- **安全**：SSO、RBAC、敏感資訊遮罩、稽核記錄。
- **可觀測**：Log、Metrics、Trace。
- **可擴展**：支援大量 VB 程式碼與文檔來源。

## 架構藍圖（建議）
### 1. 資料來源與索引
- **來源**：VB 原始碼、Spec/需求、變更單、DB Schema、批次腳本、監控/告警手冊。
- **解析器**：
  - VB AST / Regex 混合抽取（模組、函式、參數、依賴）。
  - DB Schema / API Spec / 批次作業配置抽取。
- **文件加工**：
  - LLM 摘要與標準化模板生成。
  - Speaker 規格輸出（JSON/YAML）

### 2. 內容與檢索層
- **內容儲存**：Git + Headless CMS（或 Wiki 引擎）
- **結構化索引**：PostgreSQL（結構化欄位）
- **向量索引**：向量資料庫（例如：pgvector/Weaviate/FAISS）

### 3. 服務層
- **API**：搜尋、問答、文檔管理、關聯圖查詢
- **LLM 服務**：摘要/萃取/問答
- **權限**：SSO + RBAC + 審核流

### 4. 展示層
- **Wiki UI**：搜尋、導航、依賴圖、流程圖
- **Speaker 規格檢視**：可直接導出為 JSON/YAML

## 內容模板（建議）
### 模組/功能說明模板
- **名稱**
- **用途**（摘要）
- **輸入/輸出**（參數與回傳）
- **依賴**（DB、API、檔案、外部系統）
- **流程**（圖/步驟）
- **錯誤處理**
- **效能/限制**
- **範例**
- **變更記錄**

### Speaker 規格（示例欄位）
```yaml
speaker:
  name: <模組名稱>
  summary: <用途>
  io:
    inputs: [..]
    outputs: [..]
  dependencies:
    db_tables: [..]
    apis: [..]
    files: [..]
  flow:
    steps:
      - id: 1
        desc: <步驟說明>
  errors:
    - code: <錯誤碼>
      desc: <錯誤說明>
  performance:
    notes: <限制與注意>
  examples:
    - title: <範例>
      code: <範例內容>
```

## LLM 輔助流程
1. **抽取**：從 VB 原始碼與規格文件自動抽取結構化資訊。
2. **標準化**：依模板生成內容草稿。
3. **人工審核**：由系統維運/開發人員確認準確度。
4. **更新監控**：針對變更單或 PR 自動觸發更新建議。

## 推薦的落地步驟
### Phase 0：盤點與試點
- 選 1～2 個核心模組試點
- 建立模板與 Speaker 規格
- 建置最小可用搜尋與問答

### Phase 1：規模化
- 擴大解析器與自動化內容生成
- 引入權限、審核流程
- 加入可觀測性與稽核

### Phase 2：遷移準備
- 建立全量 Speaker 規格輸出
- 對應新語言架構的 mapping（模組→服務/類別）
- 建立自動化輸出與同步機制

## 交付物清單（建議）
- Wiki 架構與分類設計
- 內容模板與範例
- 解析器與 LLM pipeline 設計
- Speaker 規格範本與輸出範例
- 角色與流程（審核、更新、稽核）

## 風險與對策
- **內容正確性**：加強人工審核與抽樣校驗
- **資料敏感性**：遮罩與權限分級
- **LLM 成本**：分層摘要與增量更新策略
- **維護負擔**：自動化更新與版本控制

